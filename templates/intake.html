<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MediAssist | Patient Intake Form</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        /* Add minimal styling for required fields display */
        .req { color: var(--color-danger); font-weight: bold; }
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-heartbeat"></i>
            <span>MediAssist <small class="text-muted">Check-In</small></span>
        </a>
        <a href="/patient/logout" class="btn btn-outline-secondary btn-sm" aria-label="Exit to home page">
            <i class="fas fa-arrow-left me-1"></i> Exit
        </a>
    </div>
</nav>

<!-- MAIN CONTENT -->
<main class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            
            <!-- HERO SECTION -->
            <div class="hero-section">
                <h2 id="heroTitle">
                    <i class="fas fa-clipboard-user me-2"></i>
                    Begin Your Clinical Check-In
                </h2>
                <p id="heroDesc">
                    This pre-visit intake will help your doctor prepare for your appointment. 
                    Please answer honestly and thoroughly.
                </p>
            </div>

            <!-- ERROR MESSAGE DISPLAY -->
            {% if error %}
            <div class="alert alert-danger mb-4">{{ error }}</div>
            {% endif %}

            <!-- LANGUAGE SELECTOR -->
            <div class="d-flex justify-content-end mb-4">
                <div style="max-width: 180px;">
                    <label for="languageSelect" class="form-label small mb-2">Interface Language:</label>
                    <select class="form-select form-select-sm" id="languageSelect" onchange="switchLanguage(this.value)" aria-label="Select interface language">
                        <option value="English" selected>ЁЯЗмЁЯЗз English</option>
                        <option value="Hindi">ЁЯЗоЁЯЗ│ рд╣рд┐рдиреНрджреА (Hindi)</option>
                    </select>
                </div>
            </div>

            <!-- FORM CARD -->
            <!-- ACTION: Submits directly to the server, expecting a redirect -->
            <form action="/patient/submit" method="POST" class="form-card" novalidate>
                <!-- Hidden language input for backend -->
                <input type="hidden" name="language" id="hiddenLanguage" value="English">

                <div class="row g-3">

                    <!-- ===== DOCTOR SELECTION (Updated to use Model IDs) ===== -->
                    <div class="col-12">
                        <div class="form-row-label" id="sectionDoctor">ЁЯСитАНтЪХя╕П Select Your Doctor</div>
                    </div>

                    <div class="col-12">
                        <label for="selectDoctor" class="form-label" id="lbl_doctor">Which doctor are you visiting? <span class="req">*</span></label>
                        <select id="selectDoctor" name="doctor_id" class="form-select" required>
                            <option value="">-- Select a Doctor --</option>
                            {% for doctor in doctors %}
                            <!-- VALUE IS THE DOCTOR'S DB ID (Integer) -->
                            <option value="{{ doctor.id }}">{{ doctor.name }} - {{ doctor.specialty }}</option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">Your case will be reviewed by this provider</small>
                    </div>

                    <!-- ===== DEMOGRAPHICS SECTION ===== -->
                    <div class="col-12">
                        <div class="form-row-label" id="sectionDemographics">ЁЯСд Personal Information</div>
                    </div>

                    <div class="col-sm-6">
                        <label for="inputName" class="form-label" id="lbl_name">Full Name</label>
                        <input type="text" id="inputName" name="name" class="form-control" placeholder="Enter your full name" required>
                        <small class="form-text text-muted">As shown on your ID</small>
                    </div>

                    <div class="col-sm-3">
                        <label for="inputAge" class="form-label" id="lbl_age">Age <span class="req">*</span></label>
                        <input type="number" id="inputAge" name="age" class="form-control" min="0" max="150" required aria-describedby="ageHelp">
                        <small id="ageHelp" class="form-text text-muted">In years</small>
                    </div>

                    <div class="col-sm-3">
                        <label for="selectGender" class="form-label" id="lbl_gender">Gender</label>
                        <select id="selectGender" name="gender" class="form-select">
                            <option>Female</option>
                            <option>Male</option>
                            <option>Other</option>
                        </select>
                    </div>

                    <!-- ===== VITALS SECTION (Simplified for Brevity) ===== -->
                    <div class="col-12 mt-2">
                        <div class="form-row-label" id="sectionVitals">ЁЯУК Vital Signs</div>
                    </div>

                    <div class="col-sm-4">
                        <label for="inputTemp" class="form-label" id="lbl_temp">Temperature (┬░C)</label>
                        <input type="number" id="inputTemp" name="temperature" class="form-control" min="30" max="45" step="0.1" placeholder="37.0">
                    </div>
                    
                    <div class="col-sm-4">
                        <label for="inputBP" class="form-label" id="lbl_bp">Blood Pressure (optional)</label>
                        <input type="text" id="inputBP" name="blood_pressure" class="form-control" placeholder="e.g. 120/80">
                    </div>

                    <div class="col-sm-4">
                        <label for="inputDuration" class="form-label" id="lbl_duration">Duration <span class="req">*</span></label>
                        <input type="text" id="inputDuration" name="duration" class="form-control" placeholder="e.g. 2 days, 1 week" required>
                    </div>

                    <!-- ===== MEDICAL HISTORY SECTION ===== -->
                    <div class="col-12 mt-2">
                        <div class="form-row-label" id="sectionMedical">тЪХя╕П Medical Information</div>
                    </div>

                    <div class="col-md-6">
                        <label for="inputAllergies" class="form-label" id="lbl_allergies">Allergies <span class="req">*</span></label>
                        <input type="text" id="inputAllergies" name="allergies" class="form-control" placeholder="e.g. Penicillin, Peanuts, or 'None'" required>
                    </div>

                    <div class="col-md-6">
                        <label for="inputMeds" class="form-label" id="lbl_meds">Current Medications <span class="req">*</span></label>
                        <input type="text" id="inputMeds" name="current_medications" class="form-control" placeholder="e.g. Aspirin 100mg daily, or 'None'" required>
                    </div>

                    <!-- ===== CHIEF COMPLAINT SECTION ===== -->
                    <div class="col-12 mt-2">
                        <div class="form-row-label" id="sectionComplaint">ЁЯПе Chief Complaint</div>
                    </div>

                    <div class="col-12">
                        <label for="textSymptoms" class="form-label" id="lbl_symptoms">Describe Your Symptoms <span class="req">*</span></label>
                        <textarea id="textSymptoms" name="symptoms" class="form-control" rows="5" placeholder="Please describe what you are experiencing, when it started, and how it affects you..." required></textarea>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="1" id="confirm" name="confirm" required>
                            <label class="form-check-label small-muted" for="confirm">I confirm this data is accurate and I understand this is an AI tool for my doctor.</label>
                        </div>
                    </div>

                    <!-- ===== SUBMIT BUTTON ===== -->
                    <div class="col-12 text-center mt-4">
                        <button type="submit" class="btn-medical w-100" id="btnSubmit">
                            <i class="fas fa-wand-magic-sparkles me-2"></i>
                            <span id="btnText">Generate Clinical Summary</span>
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- Error messages will appear here if the form fails on the server -->
            {% if error %}
            <div class="alert alert-danger mt-4">{{ error }}</div>
            {% endif %}

        </div>
    </div>
</main>

<!-- SCRIPTS (Translation logic only) -->
<script>
    const TRANSLATIONS = {
        'Hindi': {
            'heroTitle': '<i class="fas fa-clipboard-user me-2"></i>рдЕрдкрдиреА рдХреНрд▓рд┐рдирд┐рдХрд▓ рдЪреЗрдХ-рдЗрди рд╢реБрд░реВ рдХрд░реЗрдВ',
            'heroDesc': 'рдпрд╣ рдкреНрд░реА-рд╡рд┐рдЬрд┐рдЯ рдЗрдирдЯреЗрдХ рдЖрдкрдХреЗ рдбреЙрдХреНрдЯрд░ рдХреЛ рдЖрдкрдХреА рдореБрд▓рд╛рдХрд╛рдд рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред рдХреГрдкрдпрд╛ рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ рдФрд░ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЙрддреНрддрд░ рджреЗрдВред',
            'sectionDoctor': 'ЁЯСитАНтЪХя╕П рдЕрдкрдиреЗ рдбреЙрдХреНрдЯрд░ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ',
            'sectionDemographics': 'ЁЯСд рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЬрд╛рдирдХрд╛рд░реА',
            'sectionVitals': 'ЁЯУК рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдВрдХреЗрдд',
            'sectionMedical': 'тЪХя╕П рдЪрд┐рдХрд┐рддреНрд╕реАрдп рдЬрд╛рдирдХрд╛рд░реА',
            'sectionComplaint': 'ЁЯПе рдореБрдЦреНрдп рд╢рд┐рдХрд╛рдпрдд',
            'lbl_name': 'рдкреВрд░рд╛ рдирд╛рдо',
            'lbl_age': 'рдЙрдореНрд░ <span class="req">*</span>',
            'lbl_gender': 'рд▓рд┐рдВрдЧ',
            'lbl_temp': 'рддрд╛рдкрдорд╛рди (┬░C)',
            'lbl_bp': 'рд░рдХреНрддрдЪрд╛рдк (BP)',
            'lbl_duration': 'рдпрд╣ рдХрд┐рддрдиреЗ рд╕рдордп рд╕реЗ рд╣реИ? <span class="req">*</span>',
            'lbl_allergies': 'рдПрд▓рд░реНрдЬреА <span class="req">*</span>',
            'lbl_meds': 'рд╡рд░реНрддрдорд╛рди рджрд╡рд╛рдПрдВ <span class="req">*</span>',
            'lbl_symptoms': 'рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ (рдХреНрдпрд╛ рдорд╣рд╕реВрд╕ рд╣реЛ рд░рд╣рд╛ рд╣реИ?) <span class="req">*</span>',
            'btnText': 'рд╕рд╛рд░рд╛рдВрд╢ рдмрдирд╛рдПрдВ'
        },
        'English': {
            'heroTitle': '<i class="fas fa-clipboard-user me-2"></i>Begin Your Clinical Check-In',
            'heroDesc': 'This pre-visit intake will help your doctor prepare for your appointment. Please answer honestly and thoroughly.',
            'sectionDoctor': 'ЁЯСитАНтЪХя╕П Select Your Doctor',
            'sectionDemographics': 'ЁЯСд Personal Information',
            'sectionVitals': 'ЁЯУК Vital Signs',
            'sectionMedical': 'тЪХя╕П Medical Information',
            'sectionComplaint': 'ЁЯПе Chief Complaint',
            'lbl_name': 'Full Name',
            'lbl_age': 'Age <span class="req">*</span>',
            'lbl_gender': 'Gender',
            'lbl_temp': 'Temperature (┬░C)',
            'lbl_bp': 'Blood Pressure (optional)',
            'lbl_duration': 'Duration <span class="req">*</span>',
            'lbl_allergies': 'Allergies <span class="req">*</span>',
            'lbl_meds': 'Current Medications <span class="req">*</span>',
            'lbl_symptoms': 'Describe Your Symptoms <span class="req">*</span>',
            'btnText': 'Generate Clinical Summary'
        }
    };

    function switchLanguage(lang) {
        document.getElementById('hiddenLanguage').value = lang;
        const textData = TRANSLATIONS[lang];

        // Update labels and static text
        const ids = ['heroTitle', 'heroDesc', 'sectionDoctor', 'sectionDemographics', 'sectionVitals', 'sectionMedical', 'sectionComplaint', 'lbl_name', 'lbl_age', 'lbl_gender', 'lbl_temp', 'lbl_bp', 'lbl_duration', 'lbl_allergies', 'lbl_meds', 'lbl_symptoms', 'btnText'];
        ids.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.innerHTML = textData[id] || el.innerHTML;
        });

        // Update placeholders
        const symptomsArea = document.getElementById('textSymptoms');
        if(lang === 'Hindi') {
            symptomsArea.placeholder = 'рдХреГрдкрдпрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдПрдВ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдорд╣рд╕реВрд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ...';
            document.getElementById('inputName').placeholder = 'рдЕрдкрдирд╛ рдкреВрд░рд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ';
            document.getElementById('inputDuration').placeholder = 'рдЙрджрд╛. 2 рджрд┐рди';
        } else {
            symptomsArea.placeholder = 'Please describe what you are experiencing...';
            document.getElementById('inputName').placeholder = 'Enter your full name';
            document.getElementById('inputDuration').placeholder = 'e.g. 2 days, 1 week';
        }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>